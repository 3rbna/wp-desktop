machine:
    node:
        version: 7.4.0
    environment:
        GYM_CODE_SIGNING_IDENTITY: "Developer ID Application: Automattic, Inc. (PZYM8XX95Q)"

# checkout
checkout:
    post:
        - git submodule init
        - git submodule update
        - >
            cd calypso;
            if [ -n "${CALYPSO_HASH}" ]; then
                git fetch;
                git checkout ${CALYPSO_HASH};
            fi

# pre-test
dependencies:
    cache_directories:
        - "calypso/node_modules"

deployment:
    beta-release:
        tag: /\d\.\d.\d*-beta\d
        owner: automattic
        commands:
            - make release-linux
